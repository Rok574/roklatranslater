<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>iOS Home</title>
<link href="https://fonts.cdnfonts.com/css/sf-pro-display" rel="stylesheet">

<style>
:root{
  --sf:"SF Pro Display",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  --radius-app:18px;
  --radius-dock:32px;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  -webkit-tap-highlight-color:transparent;
}

html,body{
  height:100%;
  font-family:var(--sf);
  background:#000;
  color:white;
  overflow:hidden;
}

#wallpaper{
  position:fixed;
  inset:0;
  background:#000 center/cover no-repeat;
  z-index:0;
}

#home{
  position:relative;
  z-index:1;
  height:calc(100vh - 220px);
  display:flex;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  scroll-behavior:smooth;
  -webkit-overflow-scrolling:touch;
}

.page{
  flex:0 0 100%;
  height:100%;
  padding:20px;
  display:grid;
  grid-template-columns:repeat(var(--cols),1fr);
  gap:var(--gap);
  align-content:start;
  overflow-y:auto;
  scroll-snap-align:start;
}

#dock{
  position:fixed;
  bottom:env(safe-area-inset-bottom,12px);
  left:50%;
  transform:translateX(-50%);
  z-index:10;
  background:rgba(40,40,45,0.95);
  border-radius:var(--radius-dock);
  display:flex;
  justify-content:center;
}

body.iphone #dock{width:min(420px,calc(100% - 40px));padding:14px 20px;gap:24px}
body.ipad #dock{width:min(620px,calc(100% - 48px));padding:18px 28px;gap:32px}

.app{
  text-align:center;
  cursor:pointer;
  position:relative;
  transition:transform .15s;
}

.app:active{transform:scale(.92)}

body.iphone .app img{width:64px;height:64px;border-radius:14px}
body.ipad .app img{width:72px;height:72px;border-radius:18px}

.app span{
  display:block;
  margin-top:6px;
  font-size:12px;
}

.delete-x{
  position:absolute;
  top:-8px;
  right:-8px;
  width:24px;
  height:24px;
  background:#ff3b30;
  border-radius:50%;
  display:none;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

body.edit-mode .app.is-custom .delete-x{display:flex}
body.edit-mode .app{animation:wiggle .8s infinite}

@keyframes wiggle{
  0%,100%{transform:rotate(-3deg)}
  25%{transform:rotate(3deg)}
  50%{transform:rotate(-2deg)}
  75%{transform:rotate(2deg)}
}

#done{
  position:fixed;
  top:24px;
  right:24px;
  background:#007aff;
  padding:7px 20px;
  border-radius:30px;
  display:none;
  cursor:pointer;
}

.window{
  position:fixed;
  inset:0;
  z-index:20;
  background:#000;
  display:none;
  flex-direction:column;
}

.header{
  height:54px;
  display:flex;
  align-items:center;
  padding:0 16px;
  border-bottom:1px solid #222;
  font-size:17px;
  font-weight:600;
}

textarea,input{
  width:100%;
  background:#111;
  color:white;
  border:1px solid #222;
  border-radius:12px;
  padding:12px;
  font-size:17px;
}
button{
  background:#007aff;
  color:white;
  border:none;
  border-radius:12px;
  padding:14px;
  font-size:17px;
  margin-top:8px;
}
</style>
</head>
<body>

<div id="wallpaper"></div>
<div id="home"></div>
<div id="dock"></div>
<div id="done" onclick="exitEditMode()">Done</div>

<script>
let deviceMode = localStorage.getItem('deviceMode') || 'iphone';
let dockLimit = deviceMode==='ipad'?6:4;

document.body.classList.add(deviceMode);

let apps = JSON.parse(localStorage.getItem('apps')) || [
  {name:"Notes",id:"notes",icon:"https://i.imgur.com/9D6V4Xx.png",isCustom:false,dock:true},
  {name:"Browser",id:"browser",icon:"https://i.imgur.com/XV3Txqf.png",isCustom:false,dock:false},
  {name:"Settings",id:"settings",icon:"https://i.imgur.com/crghH6U.png",isCustom:false,dock:false}
];

let editMode=false;
const homeEl=document.getElementById('home');
const dockEl=document.getElementById('dock');

function saveApps(){
  localStorage.setItem('apps',JSON.stringify(apps));
}

function createAppEl(app){
  const el=document.createElement('div');
  el.className='app';
  if(app.isCustom)el.classList.add('is-custom');
  el.draggable=true;
  el.dataset.id=app.id||app.url||app.name;
  el.innerHTML=`<img src="${app.icon}"><span>${app.name}</span>`;

  if(app.isCustom){
    const x=document.createElement('div');
    x.className='delete-x';
    x.textContent='Ã—';
    x.onclick=e=>{
      e.stopPropagation();
      if(!confirm(`Delete "${app.name}"?`))return;
      apps=apps.filter(a=>
        (a.id||a.url||a.name)!==(app.id||app.url||app.name)
      );
      saveApps();
      render();
    };
    el.appendChild(x);
  }

  el.onclick=()=>{
    if(editMode)return;
    if(app.url)window.open(app.url,'_blank');
  };

  el.addEventListener('dragstart',e=>{
    if(!editMode){e.preventDefault();return;}
    el.classList.add('dragging');
  });

  el.addEventListener('dragend',()=>{
    el.classList.remove('dragging');
    saveApps();
  });

  return el;
}

function render(){
  dockEl.innerHTML='';
  homeEl.innerHTML='';

  const dockApps=apps.filter(a=>a.dock).slice(0,dockLimit);
  dockApps.forEach(a=>dockEl.appendChild(createAppEl(a)));

  const homeApps=apps.filter(a=>!a.dock);
  const page=document.createElement('div');
  page.className='page';
  page.style.setProperty('--cols',4);
  page.style.setProperty('--gap','22px');
  homeApps.forEach(a=>page.appendChild(createAppEl(a)));
  homeEl.appendChild(page);
}

function enterEditMode(){
  editMode=true;
  document.body.classList.add('edit-mode');
  document.getElementById('done').style.display='block';
}
function exitEditMode(){
  editMode=false;
  document.body.classList.remove('edit-mode');
  document.getElementById('done').style.display='none';
  saveApps();
  render();
}

function addCustomWebApp(name,url,iconData){
  if(!url.startsWith('http://')&&!url.startsWith('https://')){
    url='https://'+url;
  }
  apps.push({
    name:name,
    url:url,
    icon:iconData,
    isCustom:true,
    dock:false
  });
  saveApps();
  render();
  alert('Added to Home Screen');
}

const savedWallpaper=localStorage.getItem('wallpaper');
if(savedWallpaper){
  document.getElementById('wallpaper').style.backgroundImage=`url(${savedWallpaper})`;
}

render();
</script>
</body>
</html>
