<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>iOS 18 Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link href="https://fonts.cdnfonts.com/css/sf-pro-display" rel="stylesheet">
<style>
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin:0; font-family:'SF Pro Display',-apple-system,sans-serif; background:black; overflow:hidden; }
#wallpaper { position:fixed; inset:0; background:#000 center/cover no-repeat; z-index:0; filter:brightness(0.92); }

body.iphone .app img { width:68px; height:68px; border-radius:22px; box-shadow:0 4px 12px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.25); }
body.iphone .app span { font-size:13px; margin-top:7px; text-shadow:0 1px 3px #000; }
body.ipad .app img { width:76px; height:76px; border-radius:24px; box-shadow:0 5px 14px rgba(0,0,0,0.55), inset 0 1px 0 rgba(255,255,255,0.28); }
body.ipad .app span { font-size:14px; margin-top:8px; text-shadow:0 1px 3px #000; }

#home { position:relative; z-index:1; height:calc(100vh - 230px); display:flex; overflow-x:auto; scroll-snap-type:x mandatory; scroll-behavior:smooth; -webkit-overflow-scrolling:touch; }
.page { flex:0 0 100%; height:100%; padding:28px 20px 20px; scroll-snap-align:start; display:grid; grid-template-columns:repeat(var(--cols),1fr); gap:var(--gap); align-content:start; overflow-y:auto; }

#dock { position:fixed; bottom:22px; left:50%; transform:translateX(-50%); background:rgba(255,255,255,0.22); backdrop-filter:blur(30px); border-radius:34px; display:flex; justify-content:space-evenly; align-items:center; z-index:2; padding:16px 28px; }
body.iphone #dock { width:min(440px, calc(100% - 36px)); gap:22px; }
body.ipad #dock { width:min(660px, calc(100% - 48px)); gap:32px; padding:20px 36px; }
#dock .app { min-width:68px; text-align:center; }
body.ipad #dock .app { min-width:78px; }

.app { color:white; cursor:pointer; position:relative; transition:transform .2s cubic-bezier(0.25,0.46,0.45,0.94); }
.app:active { transform:scale(0.9); }
.app.dragging { opacity:0.65; transform:scale(1.15); z-index:100; }
.delete-x { position:absolute; top:-6px; right:-6px; width:26px; height:26px; background:#ff3b30; color:white; border-radius:50%; font-size:20px; font-weight:700; display:none; align-items:center; justify-content:center; box-shadow:0 3px 8px rgba(0,0,0,0.5); }
body.edit-mode .app.is-custom .delete-x { display:flex; }
body.edit-mode .app { animation:wiggle 0.75s infinite; }
@keyframes wiggle { 0%,100%{transform:rotate(-4deg) scale(1.03);} 25%{transform:rotate(4deg) scale(1.03);} 50%{transform:rotate(-3deg) scale(1.03);} 75%{transform:rotate(3deg) scale(1.03);} }

#done { position:fixed; top:env(safe-area-inset-top,22px); right:22px; background:rgba(0,122,255,0.9); color:white; padding:7px 22px; border-radius:999px; font-size:17px; font-weight:600; display:none; z-index:30; cursor:pointer; backdrop-filter:blur(20px); }
#pageDots { position:fixed; bottom:168px; left:50%; transform:translateX(-50%); display:flex; gap:7px; z-index:5; }
.dot { width:9px; height:9px; background:rgba(255,255,255,0.45); border-radius:50%; transition:all .3s; }
.dot.active { background:white; transform:scale(1.35); }

.window { position:fixed; inset:0; background:#000; color:white; display:none; flex-direction:column; z-index:10; }
.header { height:56px; display:flex; align-items:center; padding:0 16px; background:rgba(20,20,22,0.95); backdrop-filter:blur(30px); border-bottom:1px solid rgba(255,255,255,0.07); }
.back { font-size:18px; color:#0a84ff; cursor:pointer; }
.title { margin-left:12px; font-weight:600; font-size:17px; }
input, textarea { width:100%; background:#1c1c1e; color:white; border:none; border-radius:12px; padding:14px; font-size:17px; }
button { padding:14px; border-radius:14px; border:none; background:#0a84ff; color:white; font-size:17px; font-weight:600; margin-top:12px; }

#notesList { flex:1; overflow-y:auto; padding:10px; }
.note-item { padding:14px 16px; border-bottom:1px solid #222; cursor:pointer; }
.note-item .title { font-size:17px; font-weight:600; }
.note-item .preview { font-size:15px; color:#888; margin-top:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

#notesEditor { display:none; flex-direction:column; flex:1; }
#noteTitle { border:none; background:transparent; font-size:28px; font-weight:600; padding:20px 20px 10px; color:white; }
#noteContent { flex:1; padding:0 20px 30px; font-size:17px; line-height:1.5; background:transparent; border:none; resize:none; color:white; }

.calc-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; padding:20px; }
.calc-grid button { font-size:26px; border-radius:50%; padding:22px; }
.gray { background:#a5a5a5; color:#000; }
.dark { background:#333; color:white; }
.orange { background:#ff9500; color:white; }
.wide { grid-column:span 2; border-radius:999px; }

#deviceChooser { position:fixed; inset:0; background:rgba(0,0,0,0.96); z-index:999; display:none; flex-direction:column; align-items:center; justify-content:center; color:white; gap:40px; }
#deviceChooser h1 { font-size:28px; font-weight:600; }
#deviceChooser button { background:#0a84ff; color:white; border:none; border-radius:14px; padding:16px 48px; font-size:18px; cursor:pointer; }
</style>
</head>
<body>
<div id="wallpaper"></div>
<div id="home"></div>
<div id="dock"></div>
<div id="pageDots"></div>
<div id="done" onclick="exitEditMode()">Done</div>

<div id="deviceChooser">
  <h1>Choose your device</h1>
  <div style="display:flex;gap:30px;">
    <button onclick="setDevice('iphone')">iPhone</button>
    <button onclick="setDevice('ipad')">iPad</button>
  </div>
</div>

<div id="notes" class="window">
  <div class="header">
    <div class="back" onclick="closeNotesEditor()">Folders</div>
    <div class="title" style="flex:1;text-align:center;">Notes</div>
    <div onclick="newNote()" style="color:#0a84ff;font-size:17px;font-weight:600;cursor:pointer;">New</div>
  </div>
  <div id="notesList"></div>
  <div id="notesEditor">
    <input id="noteTitle" placeholder="Title" oninput="saveCurrentNote()">
    <textarea id="noteContent" oninput="saveCurrentNote()"></textarea>
  </div>
</div>

<div id="calculator" class="window">
  <div class="header"><div class="back" onclick="goHome()">‹ Home</div><div class="title">Calculator</div></div>
  <div id="calcDisplay" style="font-size:52px;text-align:right;padding:24px 20px;">0</div>
  <div class="calc-grid">
    <button class="gray" onclick="clearCalc()">AC</button>
    <button class="gray" onclick="toggleSign()">±</button>
    <button class="gray" onclick="percent()">%</button>
    <button class="orange" onclick="setOp('/')">÷</button>
    <button class="dark" onclick="num(7)">7</button>
    <button class="dark" onclick="num(8)">8</button>
    <button class="dark" onclick="num(9)">9</button>
    <button class="orange" onclick="setOp('*')">×</button>
    <button class="dark" onclick="num(4)">4</button>
    <button class="dark" onclick="num(5)">5</button>
    <button class="dark" onclick="num(6)">6</button>
    <button class="orange" onclick="setOp('-')">−</button>
    <button class="dark" onclick="num(1)">1</button>
    <button class="dark" onclick="num(2)">2</button>
    <button class="dark" onclick="num(3)">3</button>
    <button class="orange" onclick="setOp('+')">+</button>
    <button class="dark wide" onclick="num(0)">0</button>
    <button class="dark" onclick="dot()">.</button>
    <button class="orange" onclick="equals()">=</button>
  </div>
</div>

<div id="browser" class="window">
  <div class="header"><div class="back" onclick="goHome()">‹ Home</div><div class="title">Browser</div></div>
  <div style="padding:15px;">
    <input id="browserUrl" placeholder="Enter URL">
    <button onclick="openBrowserUrl()">Go</button>
    <h3>Favorites</h3>
    <input id="favUrl" placeholder="Add favorite URL">
    <button onclick="addFavorite()">Add Favorite</button>
    <div id="favorites"></div>
  </div>
</div>

<div id="settings" class="window">
  <div class="header"><div class="back" onclick="goHome()">‹ Home</div><div class="title">Settings</div></div>
  <div class="content">
    <div class="group">
      <h3>Wallpaper</h3>
      <input type="file" accept="image/*" onchange="setWallpaper(this)" style="margin:8px 16px;">
    </div>
    <div class="group">
      <h3>Add Web App</h3>
      <input id="webappName" placeholder="App Name" style="margin:8px 16px;">
      <input id="webappUrl" placeholder="https://youtube.com" style="margin:8px 16px;">
      <input id="webappIcon" type="file" accept="image/*" style="margin:8px 16px;">
      <button onclick="addCustomWebApp()" style="margin:12px 16px;">Add to Home Screen</button>
    </div>
  </div>
</div>

<script>
let deviceMode = localStorage.getItem('deviceMode');
if (!deviceMode) document.getElementById('deviceChooser').style.display = 'flex';

function setDevice(mode) {
  localStorage.setItem('deviceMode', mode);
  deviceMode = mode;
  document.getElementById('deviceChooser').style.display = 'none';
  applyLayout();
  render();
}

function applyLayout() {
  document.body.classList.remove('iphone','ipad');
  document.body.classList.add(deviceMode === 'ipad' ? 'ipad' : 'iphone');
}

let apps = JSON.parse(localStorage.getItem("apps")) || [
  { name: "Notes", id: "notes", icon: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRC4wjEB3rsNICYcrehZUz4hvDbHg4LhMh_Xw&s", isCustom: false },
  { name: "Calculator", id: "calculator", icon: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS8Je98ZqXhgWmbiohpPpuBO2oNgajOWG3mHw&s", isCustom: false },
  { name: "Chrome", id: "browser", icon: "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource221/v4/e6/16/cd/e616cd30-09be-220e-fc18-d1ffea0ab74e/Placeholder.mill/200x200bb-75.webp", isCustom: false },
  { name: "Settings", id: "settings", icon: "https://i.imgur.com/crghH6U.png", isCustom: false }
];
let editMode = false;
let pressTimer;

const home = document.getElementById("home");
const dock = document.getElementById("dock");

function createAppEl(app) {
  const el = document.createElement("div");
  el.className = "app";
  if (app.isCustom) el.classList.add("is-custom");
  el.draggable = true;
  el.dataset.id = app.id || app.url || app.name;
  el.innerHTML = `<img src="${app.icon}"><span>${app.name}</span>`;
  if (app.isCustom) {
    const x = document.createElement("div");
    x.className = "delete-x";
    x.textContent = "×";
    x.onclick = e => { e.stopImmediatePropagation(); if(confirm(`Delete "${app.name}"?`)) { apps = apps.filter(a=>a!==app); localStorage.setItem("apps",JSON.stringify(apps)); render(); } };
    el.appendChild(x);
  }
  el.onclick = () => {
    if (editMode) return;
    if (app.id) openApp(app.id);
    else if (app.url) window.open(app.url, "_blank");
  };
  const start = () => pressTimer = setTimeout(() => enterEditMode(), 500);
  const cancel = () => clearTimeout(pressTimer);
  el.addEventListener("mousedown", start);
  el.addEventListener("mouseup", cancel);
  el.addEventListener("mouseleave", cancel);
  el.addEventListener("touchstart", start);
  el.addEventListener("touchend", cancel);
  el.addEventListener("touchcancel", cancel);
  el.addEventListener("dragstart", e => {
    if (!editMode) { e.preventDefault(); return; }
    e.dataTransfer.setData("text/plain", el.dataset.id);
    el.classList.add("dragging");
  });
  el.addEventListener("dragend", () => { el.classList.remove("dragging"); syncOrder(); });
  return el;
}

function render() {
  renderDock();
  renderPages();
}

function renderDock() {
  dock.innerHTML = "";
  const dockCount = deviceMode === 'ipad' ? 6 : 4;
  for (let i = 0; i < dockCount && i < apps.length; i++) {
    dock.appendChild(createAppEl(apps[i]));
  }
}

function renderPages() {
  home.innerHTML = "";
  const dockCount = deviceMode === 'ipad' ? 6 : 4;
  const homeApps = apps.slice(dockCount);
  const cols = deviceMode === 'ipad' ? 6 : 4;
  const gap = deviceMode === 'ipad' ? '28px' : '22px';
  const maxPerPage = cols * 5;
  const numPages = Math.max(1, Math.ceil(homeApps.length / maxPerPage));
  for (let p = 0; p < numPages; p++) {
    const page = document.createElement('div');
    page.className = 'page';
    page.style.setProperty('--cols', cols);
    page.style.setProperty('--gap', gap);
    const start = p * maxPerPage;
    const pageApps = homeApps.slice(start, start + maxPerPage);
    pageApps.forEach(app => page.appendChild(createAppEl(app)));
    home.appendChild(page);
    page.addEventListener('dragover', handlePageDragOver);
    page.addEventListener('drop', handlePageDrop);
  }
  if (home.children.length === 0) {
    const empty = document.createElement('div');
    empty.className = 'page';
    empty.style.setProperty('--cols', cols);
    empty.style.setProperty('--gap', gap);
    home.appendChild(empty);
  }
  createPageDots(home.children.length);
}

function createPageDots(num) {
  const container = document.getElementById('pageDots');
  container.innerHTML = '';
  for (let i = 0; i < num; i++) {
    const dot = document.createElement('div');
    dot.className = 'dot';
    if (i === 0) dot.classList.add('active');
    dot.onclick = () => home.children[i]?.scrollIntoView({behavior:'smooth'});
    container.appendChild(dot);
  }
}

home.addEventListener('scroll', () => {
  const pageWidth = home.offsetWidth;
  const current = Math.round(home.scrollLeft / pageWidth);
  document.querySelectorAll('.dot').forEach((dot,i) => dot.classList.toggle('active', i===current));
});

function getAfterElement(container, pos, isHorizontal = false) {
  const items = Array.from(container.children).filter(c => !c.classList.contains("dragging"));
  return items.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = isHorizontal ? pos - box.left - box.width / 2 : pos - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) return {offset, element: child};
    return closest;
  }, {offset: Number.NEGATIVE_INFINITY}).element;
}

function handlePageDragOver(e) {
  e.preventDefault();
  const dragging = document.querySelector('.dragging');
  if (!dragging) return;
  const after = getAfterElement(e.currentTarget, e.clientY);
  if (after == null) e.currentTarget.appendChild(dragging);
  else e.currentTarget.insertBefore(dragging, after);
}

function handlePageDrop(e) {
  e.preventDefault();
  syncOrder();
}

dock.addEventListener("dragover", e => {
  e.preventDefault();
  const dragging = document.querySelector(".dragging");
  if (!dragging) return;
  const maxDock = deviceMode === 'ipad' ? 6 : 4;
  if (dock.children.length >= maxDock && !dock.contains(dragging)) {
    const last = dock.lastElementChild;
    if (last) {
      let targetPage = home.lastElementChild;
      if (!targetPage) {
        targetPage = document.createElement('div');
        targetPage.className = 'page';
        targetPage.style.setProperty('--cols', deviceMode === 'ipad' ? 6 : 4);
        targetPage.style.setProperty('--gap', deviceMode === 'ipad' ? '28px' : '22px');
        home.appendChild(targetPage);
        createPageDots(home.children.length);
      }
      targetPage.appendChild(last);
    }
  }
  const after = getAfterElement(dock, e.clientX, true);
  dock.insertBefore(dragging, after || null);
});

dock.addEventListener("drop", e => {
  e.preventDefault();
  syncOrder();
});

function enterEditMode() {
  editMode = true;
  document.body.classList.add("edit-mode");
  document.getElementById("done").style.display = "block";
}

function exitEditMode() {
  editMode = false;
  document.body.classList.remove("edit-mode");
  document.getElementById("done").style.display = "none";
}

function syncOrder() {
  const newApps = [];
  Array.from(dock.children).forEach(el => {
    const found = apps.find(a => (a.id || a.url || a.name) === el.dataset.id);
    if (found) newApps.push(found);
  });
  Array.from(home.children || []).forEach(page => {
    Array.from(page.children || []).forEach(el => {
      const found = apps.find(a => (a.id || a.url || a.name) === el.dataset.id);
      if (found) newApps.push(found);
    });
  });
  apps = newApps;
  localStorage.setItem("apps", JSON.stringify(apps));
}

function openApp(id) { 
  document.querySelectorAll(".window").forEach(w=>w.style.display="none"); 
  document.getElementById(id).style.display="flex"; 
  if (id === "notes") renderNotesList();
}

function goHome() { document.querySelectorAll(".window").forEach(w=>w.style.display="none"); }

// ==================== NOTES iOS 18 ====================
let notesData = JSON.parse(localStorage.getItem('notesData')) || [];
let currentNoteId = null;

function renderNotesList() {
  const list = document.getElementById('notesList');
  list.innerHTML = '';
  if (notesData.length === 0) {
    const empty = document.createElement('div');
    empty.style.padding = '40px 20px';
    empty.style.textAlign = 'center';
    empty.style.color = '#888';
    empty.innerHTML = 'No notes yet.<br>Tap New to create one.';
    list.appendChild(empty);
    return;
  }
  notesData.forEach(note => {
    const div = document.createElement('div');
    div.className = 'note-item';
    div.innerHTML = `
      <div class="title">${note.title || 'Untitled'}</div>
      <div class="preview">${note.content ? note.content.substring(0, 80) + '...' : 'Empty note'}</div>
    `;
    div.onclick = () => openNote(note.id);
    list.appendChild(div);
  });
}

function newNote() {
  const newNote = {
    id: Date.now(),
    title: 'New Note',
    content: ''
  };
  notesData.unshift(newNote);
  localStorage.setItem('notesData', JSON.stringify(notesData));
  openNote(newNote.id);
}

function openNote(id) {
  currentNoteId = id;
  const note = notesData.find(n => n.id === id);
  if (!note) return;
  document.getElementById('notesList').style.display = 'none';
  document.getElementById('notesEditor').style.display = 'flex';
  document.getElementById('noteTitle').value = note.title || '';
  document.getElementById('noteContent').value = note.content || '';
}

function closeNotesEditor() {
  saveCurrentNote();
  document.getElementById('notesList').style.display = 'block';
  document.getElementById('notesEditor').style.display = 'none';
  renderNotesList();
}

function saveCurrentNote() {
  if (!currentNoteId) return;
  const note = notesData.find(n => n.id === currentNoteId);
  if (note) {
    note.title = document.getElementById('noteTitle').value;
    note.content = document.getElementById('noteContent').value;
    localStorage.setItem('notesData', JSON.stringify(notesData));
  }
}

// ==================== OTHER APPS ====================
let current = "0", operator = null, stored = null;
const disp = document.getElementById("calcDisplay");
function update(){ disp.textContent = current; }
function num(n){ current = current === "0" ? ""+n : current+n; update(); }
function dot(){ if(!current.includes(".")) current+="."; update(); }
function clearCalc(){ current="0"; stored=null; operator=null; update(); }
function toggleSign(){ current = "" + (-parseFloat(current)); update(); }
function percent(){ current = "" + (parseFloat(current)/100); update(); }
function setOp(op){ stored = parseFloat(current); operator = op; current="0"; }
function equals(){
  const a = stored, b = parseFloat(current);
  if(operator==="+") current=""+(a+b);
  if(operator==="-") current=""+(a-b);
  if(operator==="*") current=""+(a*b);
  if(operator==="/") current=b?""+(a/b):"0";
  update();
}

let favorites = JSON.parse(localStorage.favorites || "[]");
function renderFavorites() {
  const list = document.getElementById("favorites");
  list.innerHTML = "";
  favorites.forEach(url => {
    const d = document.createElement("div");
    d.className = "favorite";
    d.textContent = url;
    d.onclick = () => window.open(url.startsWith("http") ? url : "https://"+url, "_blank");
    list.appendChild(d);
  });
}
function openBrowserUrl() {
  const url = document.getElementById("browserUrl").value.trim();
  if (url) window.open(url.startsWith("http") ? url : "https://"+url, "_blank");
}
function addFavorite() {
  const url = document.getElementById("favUrl").value.trim();
  if (!url) return;
  favorites.push(url.startsWith("http") ? url : "https://"+url);
  localStorage.favorites = JSON.stringify(favorites);
  document.getElementById("favUrl").value = "";
  renderFavorites();
}
renderFavorites();

function addCustomWebApp() {
  const name = document.getElementById("webappName").value.trim();
  const urlInput = document.getElementById("webappUrl").value.trim();
  const file = document.getElementById("webappIcon").files[0];
  if (!name || !urlInput) return alert("Name and URL required");
  const url = urlInput.startsWith("http") ? urlInput : "https://" + urlInput;
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      apps.push({name, url, icon: e.target.result, isCustom: true});
      localStorage.setItem("apps", JSON.stringify(apps));
      render();
      clearCustomInputs();
    };
    reader.readAsDataURL(file);
  } else {
    let domain;
    try { domain = new URL(url).hostname; } catch { domain = url.split('/')[2] || url; }
    const faviconUrl = `https://www.google.com/s2/favicons?domain=${encodeURIComponent(domain)}&sz=128`;
    const img = new Image();
    img.onload = () => {
      apps.push({name, url, icon: faviconUrl, isCustom: true});
      localStorage.setItem("apps", JSON.stringify(apps));
      render();
      clearCustomInputs();
    };
    img.onerror = () => {
      apps.push({name, url, icon: "https://img.icons8.com/ios-filled/100/ffffff/globe.png", isCustom: true});
      localStorage.setItem("apps", JSON.stringify(apps));
      render();
      clearCustomInputs();
    };
    img.src = faviconUrl;
  }
}
function clearCustomInputs() {
  document.getElementById("webappName").value = "";
  document.getElementById("webappUrl").value = "";
  document.getElementById("webappIcon").value = "";
}

function setWallpaper(input) {
  const r = new FileReader();
  r.onload = () => {
    document.getElementById("wallpaper").style.backgroundImage = `url(${r.result})`;
    localStorage.wp = r.result;
  };
  r.readAsDataURL(input.files[0]);
}
if (localStorage.wp) document.getElementById("wallpaper").style.backgroundImage = `url(${localStorage.wp})`;

applyLayout();
render();
</script>
</body>
</html>
