<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>iOS / iPadOS Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link href="https://fonts.cdnfonts.com/css/sf-pro-display" rel="stylesheet">
<style>
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin:0; font-family:'SF Pro Display',-apple-system,sans-serif; background:black; overflow:hidden; }
#wallpaper { position:fixed; inset:0; background:#000 center/cover no-repeat; z-index:0; }

/* ── iPhone layout ───────────────────────────────────── */
body.iphone #home {
  padding:30px 20px 140px;
  grid-template-columns: repeat(4, 1fr);
  gap:22px;
}
body.iphone #dock {
  width:min(420px, calc(100% - 40px));
  padding:14px 20px;
  gap:24px;
}
body.iphone .app img { width:64px; height:64px; border-radius:14px; }
body.iphone .app span { font-size:12px; margin-top:6px; }

/* ── iPad layout ─────────────────────────────────────── */
body.ipad #home {
  padding:40px 30px 160px;
  grid-template-columns: repeat(6, 1fr);
  gap:28px;
}
body.ipad #dock {
  width:min(620px, calc(100% - 48px));
  padding:18px 28px;
  gap:32px;
}
body.ipad .app img { width:72px; height:72px; border-radius:18px; }
body.ipad .app span { font-size:13px; margin-top:8px; }

/* Shared styles */
#home { position:relative; display:grid; z-index:1; }
#dock {
  position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
  background:rgba(255,255,255,.25); backdrop-filter:blur(20px);
  border-radius:28px; display:flex; justify-content:center; z-index:2;
}
.app { text-align:center; color:white; cursor:pointer; position:relative; transition:transform .15s; }
.app:active { transform:scale(0.92); }
.app.dragging { opacity:0.6; transform:scale(1.12); z-index:10; }
.delete-x {
  position:absolute; top:-8px; right:-8px; width:24px; height:24px;
  background:#ff3b30; color:white; border-radius:50%; font-size:19px; font-weight:bold;
  display:none; align-items:center; justify-content:center; box-shadow:0 2px 8px rgba(0,0,0,0.5);
}
body.edit-mode .app.is-custom .delete-x { display:flex; }
body.edit-mode .app { animation:wiggle 0.8s infinite; }
@keyframes wiggle { 0%,100%{transform:rotate(-3deg);} 25%{transform:rotate(3deg);} 50%{transform:rotate(-2deg);} 75%{transform:rotate(2deg);} }

#done { position:fixed; top:24px; right:24px; background:rgba(0,122,255,0.85); color:white; padding:7px 20px; border-radius:30px; font-size:17px; font-weight:600; display:none; z-index:30; cursor:pointer; }

/* Windows */
.window { position:fixed; inset:0; background:#000; color:white; display:none; flex-direction:column; z-index:10; }
.header { height:50px; display:flex; align-items:center; padding:0 14px; background:#111; border-bottom:1px solid #222; }
.back { font-size:18px; cursor:pointer; }
.title { margin-left:10px; font-weight:600; }
input, textarea { width:100%; background:#111; color:white; border:none; border-radius:10px; padding:10px; font-size:16px; }
button { padding:12px; border-radius:12px; border:none; background:#007aff; color:white; font-size:16px; margin-top:8px; }
.calc-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; padding:10px; }
.calc-grid button { font-size:22px; border-radius:50%; padding:20px; }
.gray { background:#a5a5a5; color:black; }
.dark { background:#333; color:white; }
.orange { background:#ff9f0a; color:white; }
.wide { grid-column:span 2; border-radius:40px; }
.favorite { padding:12px; border-bottom:1px solid #222; word-break:break-all; cursor:pointer; }

/* Device chooser */
#deviceChooser {
  position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:999;
  display:none; flex-direction:column; align-items:center; justify-content:center; color:white; gap:40px;
}
#deviceChooser h1 { font-size:28px; font-weight:600; }
#deviceChooser button {
  background:#007aff; color:white; border:none; border-radius:14px; padding:16px 40px; font-size:18px; cursor:pointer;
}
</style>
</head>
<body>
<div id="wallpaper"></div>
<div id="home"></div>
<div id="dock"></div>
<div id="done" onclick="exitEditMode()">Done</div>

<!-- DEVICE CHOOSER -->
<div id="deviceChooser">
  <h1>Choose your device</h1>
  <div style="display:flex;gap:30px;">
    <button onclick="setDevice('iphone')">iPhone</button>
    <button onclick="setDevice('ipad')">iPad</button>
  </div>
</div>

<!-- WINDOWS -->
<div id="notes" class="window">
  <div class="header"><div class="back" onclick="goHome()">‹ Home</div><div class="title">Notes</div></div>
  <textarea id="notesText" style="flex:1;"></textarea>
</div>

<div id="calculator" class="window">
  <div class="header"><div class="back" onclick="goHome()">‹ Home</div><div class="title">Calculator</div></div>
  <div id="calcDisplay" style="font-size:48px;text-align:right;padding:20px;">0</div>
  <div class="calc-grid">
    <button class="gray" onclick="clearCalc()">AC</button>
    <button class="gray" onclick="toggleSign()">±</button>
    <button class="gray" onclick="percent()">%</button>
    <button class="orange" onclick="setOp('/')">÷</button>
    <button class="dark" onclick="num(7)">7</button>
    <button class="dark" onclick="num(8)">8</button>
    <button class="dark" onclick="num(9)">9</button>
    <button class="orange" onclick="setOp('*')">×</button>
    <button class="dark" onclick="num(4)">4</button>
    <button class="dark" onclick="num(5)">5</button>
    <button class="dark" onclick="num(6)">6</button>
    <button class="orange" onclick="setOp('-')">−</button>
    <button class="dark" onclick="num(1)">1</button>
    <button class="dark" onclick="num(2)">2</button>
    <button class="dark" onclick="num(3)">3</button>
    <button class="orange" onclick="setOp('+')">+</button>
    <button class="dark wide" onclick="num(0)">0</button>
    <button class="dark" onclick="dot()">.</button>
    <button class="orange" onclick="equals()">=</button>
  </div>
</div>

<div id="browser" class="window">
  <div class="header"><div class="back" onclick="goHome()">‹ Home</div><div class="title">Browser</div></div>
  <div style="padding:15px;">
    <input id="browserUrl" placeholder="Enter URL">
    <button onclick="openBrowserUrl()">Go</button>
    <h3>Favorites</h3>
    <input id="favUrl" placeholder="Add favorite URL">
    <button onclick="addFavorite()">Add Favorite</button>
    <div id="favorites"></div>
  </div>
</div>

<div id="settings" class="window">
  <div class="header"><div class="back" onclick="goHome()">‹ Home</div><div class="title">Settings</div></div>
  <div style="padding:15px;">
    <h3>Wallpaper</h3>
    <input type="file" accept="image/*" onchange="setWallpaper(this)">
    
    <h3 style="margin-top:30px;">Add Web App</h3>
    <input id="webappName" placeholder="App Name" style="margin-bottom:8px;">
    <input id="webappUrl" placeholder="https://youtube.com" style="margin-bottom:8px;">
    <input id="webappIcon" type="file" accept="image/*" style="margin-bottom:8px;">
    <button onclick="addCustomWebApp()">Add to Home Screen</button>
  </div>
</div>

<script>
// ─── DEVICE MODE ─────────────────────────────────────────────
let deviceMode = localStorage.getItem('deviceMode');

if (!deviceMode) {
  document.getElementById('deviceChooser').style.display = 'flex';
}

function setDevice(mode) {
  localStorage.setItem('deviceMode', mode);
  deviceMode = mode;
  document.getElementById('deviceChooser').style.display = 'none';
  applyLayout();
  renderApps();
}

// ─── LAYOUT ──────────────────────────────────────────────────
function applyLayout() {
  document.body.classList.remove('iphone', 'ipad');
  document.body.classList.add(deviceMode === 'ipad' ? 'ipad' : 'iphone');
}

// ─── APPS ────────────────────────────────────────────────────
let apps = JSON.parse(localStorage.getItem("apps")) || [
  { name: "Notes", id: "notes", icon: "https://img.icons8.com/ios-filled/100/ffffff/notes.png", isCustom: false },
  { name: "Calc", id: "calculator", icon: "https://img.icons8.com/ios-filled/100/ffffff/calculator.png", isCustom: false },
  { name: "Browser", id: "browser", icon: "https://img.icons8.com/ios-filled/100/ffffff/safari.png", isCustom: false },
  { name: "Settings", id: "settings", icon: "https://img.icons8.com/ios-filled/100/ffffff/settings.png", isCustom: false }
];
let editMode = false;
let pressTimer;

const home = document.getElementById("home");
const dock = document.getElementById("dock");

function createAppEl(app) {
  const el = document.createElement("div");
  el.className = "app";
  if (app.isCustom) el.classList.add("is-custom");
  el.draggable = true;
  el.dataset.id = app.id || app.url || app.name;
  el.innerHTML = `<img src="${app.icon}"><span>${app.name}</span>`;

  if (app.isCustom) {
    const x = document.createElement("div");
    x.className = "delete-x";
    x.textContent = "×";
    x.onclick = e => { e.stopImmediatePropagation(); if(confirm(`Delete "${app.name}"?`)) { apps = apps.filter(a=>a!==app); localStorage.setItem("apps",JSON.stringify(apps)); renderApps(); } };
    el.appendChild(x);
  }

  el.onclick = () => {
    if (editMode) return;
    if (app.id) openApp(app.id);
    else if (app.url) window.open(app.url, "_blank");
  };

  const start = () => pressTimer = setTimeout(() => { enterEditMode(); }, 500);
  const cancel = () => clearTimeout(pressTimer);
  el.addEventListener("mousedown", start);
  el.addEventListener("mouseup", cancel);
  el.addEventListener("mouseleave", cancel);
  el.addEventListener("touchstart", start);
  el.addEventListener("touchend", cancel);
  el.addEventListener("touchcancel", cancel);

  el.addEventListener("dragstart", e => {
    if (!editMode) { e.preventDefault(); return; }
    e.dataTransfer.setData("text/plain", el.dataset.id);
    el.classList.add("dragging");
  });
  el.addEventListener("dragend", () => { el.classList.remove("dragging"); syncOrder(); });

  return el;
}

function renderApps() {
  home.innerHTML = "";
  dock.innerHTML = "";
  const dockCount = deviceMode === 'ipad' ? 6 : 4;
  apps.forEach((app, i) => {
    const el = createAppEl(app);
    (i < dockCount ? dock : home).appendChild(el);
  });
}

// ─── EDIT / DRAG ─────────────────────────────────────────────
function enterEditMode() {
  editMode = true;
  document.body.classList.add("edit-mode");
  document.getElementById("done").style.display = "block";
}
function exitEditMode() {
  editMode = false;
  document.body.classList.remove("edit-mode");
  document.getElementById("done").style.display = "none";
}

function getAfterElement(container, pos, horizontal) {
  const items = Array.from(container.children).filter(c => !c.classList.contains("dragging"));
  return items.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = horizontal ? pos - box.left - box.width/2 : pos - box.top - box.height/2;
    return (offset < 0 && offset > closest.offset) ? {offset, element: child} : closest;
  }, {offset: Number.NEGATIVE_INFINITY}).element;
}

[home, dock].forEach((container, isHoriz) => {
  container.addEventListener("dragover", e => {
    e.preventDefault();
    const dragging = document.querySelector(".dragging");
    if (!dragging) return;
    const after = getAfterElement(container, isHoriz ? e.clientX : e.clientY, isHoriz);
    container.insertBefore(dragging, after || null);
  });
});

function syncOrder() {
  const newApps = [];
  Array.from(dock.children).forEach(el => {
    const found = apps.find(a => (a.id || a.url || a.name) === el.dataset.id);
    if (found) newApps.push(found);
  });
  Array.from(home.children).forEach(el => {
    const found = apps.find(a => (a.id || a.url || a.name) === el.dataset.id);
    if (found) newApps.push(found);
  });
  apps = newApps;
  localStorage.setItem("apps", JSON.stringify(apps));
}

// ─── WINDOWS & FEATURES (unchanged from your working code) ──
function openApp(id) { document.querySelectorAll(".window").forEach(w=>w.style.display="none"); document.getElementById(id).style.display="flex"; }
function goHome() { document.querySelectorAll(".window").forEach(w=>w.style.display="none"); }

// Notes
document.getElementById("notesText").value = localStorage.notes || "";
document.getElementById("notesText").oninput = e => localStorage.notes = e.target.value;

// Calculator
let current = "0", operator = null, stored = null;
const disp = document.getElementById("calcDisplay");
function update(){ disp.textContent = current; }
function num(n){ current = current === "0" ? ""+n : current+n; update(); }
function dot(){ if(!current.includes(".")) current+="."; update(); }
function clearCalc(){ current="0"; stored=null; operator=null; update(); }
function toggleSign(){ current = "" + (-parseFloat(current)); update(); }
function percent(){ current = "" + (parseFloat(current)/100); update(); }
function setOp(op){ stored = parseFloat(current); operator = op; current="0"; }
function equals(){
  const a = stored, b = parseFloat(current);
  if(operator==="+") current=""+(a+b);
  if(operator==="-") current=""+(a-b);
  if(operator==="*") current=""+(a*b);
  if(operator==="/") current=b?""+(a/b):"0";
  update();
}

// Browser
let favorites = JSON.parse(localStorage.favorites || "[]");
function renderFavorites() {
  const list = document.getElementById("favorites");
  list.innerHTML = "";
  favorites.forEach(url => {
    const d = document.createElement("div");
    d.className = "favorite";
    d.textContent = url;
    d.onclick = () => window.open(url.startsWith("http") ? url : "https://"+url, "_blank");
    list.appendChild(d);
  });
}
function openBrowserUrl() {
  const url = document.getElementById("browserUrl").value.trim();
  if (url) window.open(url.startsWith("http") ? url : "https://"+url, "_blank");
}
function addFavorite() {
  const url = document.getElementById("favUrl").value.trim();
  if (!url) return;
  favorites.push(url.startsWith("http") ? url : "https://"+url);
  localStorage.favorites = JSON.stringify(favorites);
  document.getElementById("favUrl").value = "";
  renderFavorites();
}
renderFavorites();

// Custom Web App
function addCustomWebApp() {
  const name = document.getElementById("webappName").value.trim();
  const urlInput = document.getElementById("webappUrl").value.trim();
  const file = document.getElementById("webappIcon").files[0];
  if (!name || !urlInput) return alert("Name and URL required");
  const url = urlInput.startsWith("http") ? urlInput : "https://" + urlInput;
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      apps.push({name, url, icon: e.target.result, isCustom: true});
      localStorage.setItem("apps", JSON.stringify(apps));
      renderApps();
      clearCustomInputs();
    };
    reader.readAsDataURL(file);
  } else {
    apps.push({name, url, icon: "https://img.icons8.com/ios-filled/100/ffffff/globe.png", isCustom: true});
    localStorage.setItem("apps", JSON.stringify(apps));
    renderApps();
    clearCustomInputs();
  }
}
function clearCustomInputs() {
  document.getElementById("webappName").value = "";
  document.getElementById("webappUrl").value = "";
  document.getElementById("webappIcon").value = "";
}

// Wallpaper
function setWallpaper(input) {
  const r = new FileReader();
  r.onload = () => {
    document.getElementById("wallpaper").style.backgroundImage = `url(${r.result})`;
    localStorage.wp = r.result;
  };
  r.readAsDataURL(input.files[0]);
}
if (localStorage.wp) document.getElementById("wallpaper").style.backgroundImage = `url(${localStorage.wp})`;

// ─── START ───────────────────────────────────────────────────
applyLayout();
renderApps();
</script>
</body>
</html>
